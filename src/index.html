<!doctype html>
<meta charset="utf-8">
<title>mini shell </title>

<% var fs = require('fs');%>

<%=fs.readFileSync('favicon.base64.html')%>

<script data-legit=mi>
// ONERROR
<%=fs.readFileSync('boot/onerror.js')%>
//# sourceURL=/boot/onerror.js
</script>


<script data-legit=mi>

// EARLYBOOT, persistence and loader
<%=typescriptBuild(
  	'boot/*',
  	'load/*', 'persistence/*', 'boot/base.d.ts', 'typings/*')%>

// boot/bootUI.js
<%=fs.readFileSync('boot/bootUI.js')%>

earlyBoot(window);

//# sourceURL=/load/shellLoader.ts.js
</script>

<%=formatDrive.totals(new Date(), 27*1024*1024)%>

<%=formatDrive.file(
  '/shell/showCommander.js',
  typescriptBuild(
    'shell/*',
    // typescript typings
    'imports/ts/typescript.d.ts',
    // parts of persistence to reuse
    'persistence/trackChanges.ts','persistence/normalizePath.ts',
    // parts of DOM persistence to reuse
    'persistence/dom/DOMFile.ts','persistence/dom/DOMTotals.ts',
    'persistence/encodings/*','persistence/bestEncode.ts',
    // noapi emulation
    'noapi/*', 'isolation/*',
    // base UI mini-library typings
    'boot/base.d.ts',
    // persistence API
    'persistence/API.d.ts',
    // other package typings
    'typings/*'
  ))%>

<%=formatDrive.file(
  '/shell/typescript/typescript.js',
  'if (!Array.prototype.indexOf) { '+
  'Array.prototype.indexOf = function(x) { '+
  'for (var i = 0; i < this.length; i++) { if (this[i]===x) return i; } return -1; '+
  '}; }'+
  drive.read('imports/ts/typescript.js'))%>

<!-- /shell/buildMessage.js
var shell=shell||{};
shell.buildMessage = 'Built on <%=formatDrive.date(new Date())%>\n'+
  '  *using <%=require('nowindow').navigator.userAgent.replace(/\)\s/g, ')\\n   ')%>';
shell.buildTime = <%=+new Date()%>;
-->

<%=formatDrive.file('/shell/!onerror.js', drive.read('boot/onerror.js'))%>


<!-- /empty/
-->


<!-- /LF-file.txt
123
456-->

<!-- /CRLF-file [CRLF]
123
456-->

<!-- /CR-file [CR]
123
456-->

<!-- /exportsome.js
module.exports = 55-->

<!-- /exports_fs.js
module.exports = require('fs')-->

<!-- /exports_process.js
module.exports = process-->

<!-- /eval-file.txt [eval]
 "random char: " + String.fromCharCode(Math.random()*16000)+"\n"+
 "date: "+new Date()+"\n"+
 "location: "+location -->

<!-- /json-file.txt [json]
"new ok \u2222 and what\r\n or \u0001?\n\n\n"-->

<%=(function() {
	var files = drive.files();
	var styleText = [];
  for (var i = 0; i < files.length; i++) {
    var fi = files[i];
    if (/^\/shell\//.test(fi) && /.css$/.test(fi)) {
      var content = drive.read(fi);
      styleText.push(content);
		}
  }
	return formatDrive.file('/shell/style.css', styleText.join('\n'));

})()%>

<%=formatDrive.file('/shell/codemirror/cm.js', drive.read('imports/cm/cm.js'))%>
<%=formatDrive.file('/shell/codemirror/cm.css', drive.read('imports/cm/cm.css'))%>


<%=(function() {

	var files = drive.files();
	var fileDump = [];
  for (var i = 0; i < files.length; i++) {
    var content = drive.read(files[i]);
	  fileDump.push(formatDrive.file('/src'+files[i], content));
  }
	return fileDump.join('\n');

})()%>